# å¤§å¯Œç¿æ¸¸æˆåœ°å›¾ç¨‹åºè®¾è®¡æ–‡æ¡£

## 1. èŒè´£æ¦‚è¿°

åœ°å›¾ç¨‹åºå‘˜è´Ÿè´£å®ç°æ¸¸æˆåœ°å›¾ç›¸å…³çš„æ‰€æœ‰åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š
- åœ°å›¾æ•°æ®ç®¡ç†ï¼ˆæ”¯æŒå¤šç§å­˜å‚¨æ ¼å¼ï¼‰
- æ ¼å­æ•ˆæœå®ç°ï¼ˆåŒ…æ‹¬ç‰¹æ®Šæ ¼å­æ•ˆæœï¼‰
- ç©å®¶ç§»åŠ¨æ§åˆ¶ï¼ˆåŒ…æ‹¬é“å…·å½±å“ï¼‰
- åœ°å›¾äº‹ä»¶å¤„ç†ï¼ˆåŒ…æ‹¬é“¶è¡Œå’Œå•†åº—åŠŸèƒ½ï¼‰
- **å›¾å½¢åŒ–åœ°å›¾ç¼–è¾‘å™¨ï¼ˆæ–°å¢ï¼‰**

## 2. æ ¸å¿ƒåŠŸèƒ½å®ç°

### 2.1 åœ°å›¾æ•°æ®ç»“æ„
1. **åœ°å›¾åŸºç¡€ç»“æ„**
   - åœ°å›¾å°ºå¯¸ç®¡ç†
   - è·¯å¾„ç‚¹ç®¡ç†
   - æ ¼å­ç®¡ç†
   - ç‰¹æ®Šæ ¼å­è®¾ç½®

2. **åœ°å›¾åˆå§‹åŒ–**
   - åŸºç¡€æ ¼å­åˆ›å»º
   - è·¯å¾„è®¾ç½®
   - ç‰¹æ®Šæ ¼å­è®¾ç½®

```python
class Map:
    def __init__(self, width, height):
        self.width = width
        self.height = height
        self.cells = []  # å­˜å‚¨æ‰€æœ‰æ ¼å­
        self.start_position = (0, 0)
        self.path = []   # å­˜å‚¨è·¯å¾„ç‚¹
        self.initialize_map()
    
    def initialize_map(self):
        """åˆå§‹åŒ–åœ°å›¾"""
        # åˆ›å»ºåŸºç¡€æ ¼å­
        for y in range(self.height):
            for x in range(self.width):
                cell = Cell("empty", (x, y))
                self.cells.append(cell)
        
        # è®¾ç½®è·¯å¾„
        self.setup_path()
        
        # è®¾ç½®ç‰¹æ®Šæ ¼å­
        self.setup_special_cells()
    
    def setup_path(self):
        """è®¾ç½®åœ°å›¾è·¯å¾„"""
        # å¤–åœˆè·¯å¾„
        for x in range(self.width):
            self.path.append((x, 0))
        for y in range(1, self.height):
            self.path.append((self.width-1, y))
        for x in range(self.width-2, -1, -1):
            self.path.append((x, self.height-1))
        for y in range(self.height-2, 0, -1):
            self.path.append((0, y))
    
    def setup_special_cells(self):
        """è®¾ç½®ç‰¹æ®Šæ ¼å­"""
        # è®¾ç½®é“¶è¡Œ
        bank_positions = [(2, 2), (self.width-3, 2), (2, self.height-3), (self.width-3, self.height-3)]
        for pos in bank_positions:
            self.set_cell_type(pos, "bank")
        
        # è®¾ç½®å•†åº—
        shop_positions = [(4, 4), (self.width-5, 4), (4, self.height-5), (self.width-5, self.height-5)]
        for pos in shop_positions:
            self.set_cell_type(pos, "shop")
        
        # è®¾ç½®ç›‘ç‹±
        self.set_cell_type((self.width//2, self.height//2), "jail")
        
        # è®¾ç½®å¥½è¿æ ¼å’Œå„è¿æ ¼
        luck_positions = [(6, 6), (self.width-7, 6), (6, self.height-7), (self.width-7, self.height-7)]
        for pos in luck_positions:
            self.set_cell_type(pos, "luck")
        
        bad_luck_positions = [(8, 8), (self.width-9, 8), (8, self.height-9), (self.width-9, self.height-9)]
        for pos in bad_luck_positions:
            self.set_cell_type(pos, "bad_luck")
    
    def get_cell_at(self, position):
        """è·å–æŒ‡å®šä½ç½®çš„æ ¼å­"""
        x, y = position
        if 0 <= x < self.width and 0 <= y < self.height:
            index = y * self.width + x
            return self.cells[index]
        return None
    
    def set_cell_type(self, position, cell_type):
        """è®¾ç½®æ ¼å­ç±»å‹"""
        cell = self.get_cell_at(position)
        if cell:
            cell.type = cell_type
            cell.properties = self.get_cell_properties(cell_type)
    
    def get_cell_properties(self, cell_type):
        """è·å–æ ¼å­å±æ€§"""
        properties = {
            "empty": {"name": "ç©ºåœ°", "color": "#FFFFFF"},
            "bank": {"name": "é“¶è¡Œ", "color": "#4CAF50"},
            "shop": {"name": "å•†åº—", "color": "#FF9800"},
            "jail": {"name": "ç›‘ç‹±", "color": "#F44336"},
            "luck": {"name": "å¥½è¿æ ¼", "color": "#9C27B0"},
            "bad_luck": {"name": "å„è¿æ ¼", "color": "#795548"}
        }
        return properties.get(cell_type, properties["empty"])
```

### 2.2 åœ°å›¾æ•°æ®å­˜å‚¨
1. **å­˜å‚¨æ ¼å¼æ”¯æŒ**
   - æ–‡æœ¬æ–‡ä»¶ï¼ˆJSONæ ¼å¼ï¼‰
   - Excelæ–‡ä»¶
   - æ•°æ®åº“ï¼ˆSQLiteï¼‰

2. **æ•°æ®ç®¡ç†åŠŸèƒ½**
   - åœ°å›¾ä¿å­˜
   - åœ°å›¾åŠ è½½
   - æ•°æ®éªŒè¯

```python
class MapDataManager:
    def __init__(self):
        self.supported_formats = ['txt', 'xlsx', 'db']
    
    def save_map(self, map_data, format_type, file_path):
        """ä¿å­˜åœ°å›¾æ•°æ®"""
        if format_type == 'txt':
            self.save_to_txt(map_data, file_path)
        elif format_type == 'xlsx':
            self.save_to_excel(map_data, file_path)
        elif format_type == 'db':
            self.save_to_database(map_data, file_path)
    
    def load_map(self, format_type, file_path):
        """åŠ è½½åœ°å›¾æ•°æ®"""
        if format_type == 'txt':
            return self.load_from_txt(file_path)
        elif format_type == 'xlsx':
            return self.load_from_excel(file_path)
        elif format_type == 'db':
            return self.load_from_database(file_path)
    
    def save_to_txt(self, map_data, file_path):
        """ä¿å­˜ä¸ºæ–‡æœ¬æ–‡ä»¶"""
        with open(file_path, 'w', encoding='utf-8') as f:
            json.dump(map_data, f, ensure_ascii=False, indent=2)
    
    def save_to_excel(self, map_data, file_path):
        """ä¿å­˜ä¸ºExcelæ–‡ä»¶"""
        wb = openpyxl.Workbook()
        ws = wb.active
        # å†™å…¥åœ°å›¾æ•°æ®
        for cell in map_data['cells']:
            ws.cell(row=cell['y']+1, column=cell['x']+1, value=cell['type'])
        wb.save(file_path)
    
    def save_to_database(self, map_data, file_path):
        """ä¿å­˜åˆ°æ•°æ®åº“"""
        conn = sqlite3.connect(file_path)
        cursor = conn.cursor()
        # åˆ›å»ºè¡¨
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS map_cells (
                x INTEGER,
                y INTEGER,
                type TEXT,
                properties TEXT
            )
        ''')
        # æ’å…¥æ•°æ®
        for cell in map_data['cells']:
            cursor.execute(
                'INSERT INTO map_cells VALUES (?, ?, ?, ?)',
                (cell['x'], cell['y'], cell['type'], json.dumps(cell['properties']))
            )
        conn.commit()
        conn.close()
    
    def load_from_txt(self, file_path):
        """ä»æ–‡æœ¬æ–‡ä»¶åŠ è½½"""
        with open(file_path, 'r', encoding='utf-8') as f:
            return json.load(f)
    
    def load_from_excel(self, file_path):
        """ä»Excelæ–‡ä»¶åŠ è½½"""
        wb = openpyxl.load_workbook(file_path)
        ws = wb.active
        map_data = {'cells': []}
        for row in ws.rows:
            for cell in row:
                if cell.value:
                    map_data['cells'].append({
                        'x': cell.column - 1,
                        'y': cell.row - 1,
                        'type': cell.value
                    })
        return map_data
    
    def load_from_database(self, file_path):
        """ä»æ•°æ®åº“åŠ è½½"""
        conn = sqlite3.connect(file_path)
        cursor = conn.cursor()
        cursor.execute('SELECT * FROM map_cells')
        map_data = {'cells': []}
        for row in cursor.fetchall():
            map_data['cells'].append({
                'x': row[0],
                'y': row[1],
                'type': row[2],
                'properties': json.loads(row[3])
            })
        conn.close()
        return map_data
```

### 2.3 æ ¼å­ç³»ç»Ÿå®ç°
1. **åŸºç¡€æ ¼å­ç±»**
   - ä½ç½®ä¿¡æ¯
   - ç±»å‹å±æ€§
   - æ•ˆæœå¤„ç†

2. **ç‰¹æ®Šæ ¼å­ç±»**
   - é“¶è¡Œæ ¼å­
   - å•†åº—æ ¼å­
   - ç›‘ç‹±æ ¼å­
   - å¥½è¿æ ¼
   - å„è¿æ ¼

```python
class Cell:
    def __init__(self, cell_type, position):
        self.type = cell_type
        self.position = position
        self.properties = {}
        self.owner = None
        self.level = 0
    
    def handle_player_landing(self, player):
        """å¤„ç†ç©å®¶è½åœ°äº‹ä»¶"""
        if self.type == "bank":
            return self.handle_bank(player)
        elif self.type == "shop":
            return self.handle_shop(player)
        elif self.type == "jail":
            return self.handle_jail(player)
        elif self.type == "luck":
            return self.handle_luck(player)
        elif self.type == "bad_luck":
            return self.handle_bad_luck(player)
        return None
    
    def handle_bank(self, player):
        """å¤„ç†é“¶è¡Œæ ¼å­"""
        return {
            "type": "bank",
            "message": "æ¬¢è¿æ¥åˆ°é“¶è¡Œï¼Œæ‚¨å¯ä»¥è¿›è¡Œå­˜å–æ¬¾æ“ä½œ",
            "actions": ["deposit", "withdraw"]
        }
    
    def handle_shop(self, player):
        """å¤„ç†å•†åº—æ ¼å­"""
        return {
            "type": "shop",
            "message": "æ¬¢è¿æ¥åˆ°å•†åº—ï¼Œæ‚¨å¯ä»¥è´­ä¹°é“å…·å’Œéª°å­",
            "actions": ["buy_item", "buy_dice"]
        }
    
    def handle_jail(self, player):
        """å¤„ç†ç›‘ç‹±æ ¼å­"""
        return {
            "type": "jail",
            "message": "æ‚¨è¢«å…³è¿›äº†ç›‘ç‹±ï¼Œéœ€è¦æ”¯ä»˜ä¿é‡Šé‡‘æˆ–ç­‰å¾…3å›åˆ",
            "actions": ["pay_bail", "wait"]
        }
    
    def handle_luck(self, player):
        """å¤„ç†å¥½è¿æ ¼"""
        return {
            "type": "luck",
            "message": "æ­å–œæ‚¨è·å¾—å¥½è¿ï¼",
            "actions": ["get_reward"]
        }
    
    def handle_bad_luck(self, player):
        """å¤„ç†å„è¿æ ¼"""
        return {
            "type": "bad_luck",
            "message": "æ‚¨é‡åˆ°äº†å„è¿ï¼",
            "actions": ["lose_card", "go_to_jail"]
        }

class BankCell(Cell):
    def __init__(self, position):
        super().__init__("bank", position)
        self.properties = {
            "name": "é“¶è¡Œ",
            "color": "#4CAF50",
            "interest_rate": 0.1
        }
    
    def handle_player_landing(self, player):
        """å¤„ç†ç©å®¶åœ¨é“¶è¡Œæ ¼å­çš„æ“ä½œ"""
        return {
            "type": "bank",
            "message": "æ¬¢è¿æ¥åˆ°é“¶è¡Œï¼Œæ‚¨å¯ä»¥è¿›è¡Œå­˜å–æ¬¾æ“ä½œ",
            "actions": ["deposit", "withdraw"],
            "player_balance": player.balance,
            "bank_balance": player.bank_balance
        }

class ShopCell(Cell):
    def __init__(self, position):
        super().__init__("shop", position)
        self.properties = {
            "name": "å•†åº—",
            "color": "#FF9800",
            "items": {
                "è·¯éšœ": {"price": 50, "stock": 10},
                "æœºå™¨å¨ƒå¨ƒ": {"price": 30, "stock": 10}
            }
        }
    
    def handle_player_landing(self, player):
        """å¤„ç†ç©å®¶åœ¨å•†åº—æ ¼å­çš„æ“ä½œ"""
        return {
            "type": "shop",
            "message": "æ¬¢è¿æ¥åˆ°å•†åº—ï¼Œæ‚¨å¯ä»¥è´­ä¹°é“å…·",
            "actions": ["buy_item"],
            "items": self.properties["items"],
            "player_balance": player.balance
        }

class JailCell(Cell):
    def __init__(self, position):
        super().__init__("jail", position)
        self.properties = {
            "name": "ç›‘ç‹±",
            "color": "#F44336",
            "bail_cost": 5000
        }
    
    def handle_player_landing(self, player):
        """å¤„ç†ç©å®¶åœ¨ç›‘ç‹±æ ¼å­çš„æ“ä½œ"""
        return {
            "type": "jail",
            "message": "æ‚¨è¢«å…³è¿›äº†ç›‘ç‹±ï¼Œéœ€è¦æ”¯ä»˜ä¿é‡Šé‡‘æˆ–ç­‰å¾…3å›åˆ",
            "actions": ["pay_bail", "wait"],
            "bail_cost": self.properties["bail_cost"],
            "player_balance": player.balance
        }

class LuckCell(Cell):
    def __init__(self, position):
        super().__init__("luck", position)
        self.properties = {
            "name": "å¥½è¿æ ¼",
            "color": "#9C27B0",
            "rewards": [
                {"type": "money", "amount": 2000},
                {"type": "item", "item": "è·¯éšœ"},
                {"type": "item", "item": "æœºå™¨å¨ƒå¨ƒ"}
            ]
        }
    
    def handle_player_landing(self, player):
        """å¤„ç†ç©å®¶åœ¨å¥½è¿æ ¼çš„æ“ä½œ"""
        reward = random.choice(self.properties["rewards"])
        return {
            "type": "luck",
            "message": "æ­å–œæ‚¨è·å¾—å¥½è¿ï¼",
            "actions": ["get_reward"],
            "reward": reward
        }

class BadLuckCell(Cell):
    def __init__(self, position):
        super().__init__("bad_luck", position)
        self.properties = {
            "name": "å„è¿æ ¼",
            "color": "#795548",
            "penalties": [
                {"type": "money", "amount": 2000},
                {"type": "card", "action": "lose"},
                {"type": "jail", "action": "go_to_jail"}
            ]
        }
    
    def handle_player_landing(self, player):
        """å¤„ç†ç©å®¶åœ¨å„è¿æ ¼çš„æ“ä½œ"""
        penalty = random.choice(self.properties["penalties"])
        return {
            "type": "bad_luck",
            "message": "æ‚¨é‡åˆ°äº†å„è¿ï¼",
            "actions": ["lose_card", "go_to_jail"],
            "penalty": penalty
        }
```

### 2.4 ç©å®¶ç§»åŠ¨æ§åˆ¶
1. **ç§»åŠ¨ç®¡ç†å™¨**
   - è·¯å¾„è®¡ç®—
   - ç§»åŠ¨éªŒè¯
   - é“å…·å½±å“

2. **ç‰¹æ®Šç§»åŠ¨æ•ˆæœ**
   - è·¯éšœå½±å“
   - æœºå™¨å¨ƒå¨ƒæ•ˆæœ

```python
class MovementManager:
    def __init__(self, game_map):
        self.game_map = game_map
        self.path = game_map.path
        self.path_length = len(self.path)
    
    def move_player(self, player, steps):
        """ç§»åŠ¨ç©å®¶"""
        # æ£€æŸ¥è·¯éšœ
        if self.check_roadblock(player, steps):
            return {
                "success": False,
                "message": "å‰æ–¹æœ‰è·¯éšœï¼Œæ— æ³•ç§»åŠ¨",
                "position": player.position
            }
        
        # è®¡ç®—æ–°ä½ç½®
        current_index = self.path.index(player.position)
        new_index = (current_index + steps) % self.path_length
        new_position = self.path[new_index]
        
        # æ›´æ–°ç©å®¶ä½ç½®
        player.position = new_position
        
        # å¤„ç†æ ¼å­æ•ˆæœ
        cell = self.game_map.get_cell_at(new_position)
        if cell:
            result = cell.handle_player_landing(player)
            return {
                "success": True,
                "message": "ç§»åŠ¨æˆåŠŸ",
                "position": new_position,
                "cell_effect": result
            }
        
        return {
            "success": True,
            "message": "ç§»åŠ¨æˆåŠŸ",
            "position": new_position
        }
    
    def check_roadblock(self, player, steps):
        """æ£€æŸ¥è·¯éšœ"""
        current_index = self.path.index(player.position)
        for i in range(1, steps + 1):
            check_index = (current_index + i) % self.path_length
            check_position = self.path[check_index]
            cell = self.game_map.get_cell_at(check_position)
            if cell and cell.type == "roadblock":
                return True
        return False
    
    def handle_machine_doll(self, player, target_position):
        """å¤„ç†æœºå™¨å¨ƒå¨ƒæ•ˆæœ"""
        if target_position in self.path:
            # è®¡ç®—ç§»åŠ¨æ­¥æ•°
            current_index = self.path.index(player.position)
            target_index = self.path.index(target_position)
            steps = (target_index - current_index) % self.path_length
            
            return self.move_player(player, steps)
        return {
            "success": False,
            "message": "æ— æ•ˆçš„ç›®æ ‡ä½ç½®"
        }
```

### 2.5 åœ°å›¾äº‹ä»¶å¤„ç†
1. **äº‹ä»¶ç®¡ç†å™¨**
   - äº‹ä»¶è§¦å‘
   - æ•ˆæœå¤„ç†
   - çŠ¶æ€æ›´æ–°

2. **ç‰¹æ®Šäº‹ä»¶å¤„ç†**
   - é“¶è¡Œäº‹ä»¶
   - å•†åº—äº‹ä»¶
   - ç›‘ç‹±äº‹ä»¶

```python
class MapEventManager:
    def __init__(self, game_map):
        self.game_map = game_map
        self.event_handlers = {
            "bank": self.handle_bank_event,
            "shop": self.handle_shop_event,
            "jail": self.handle_jail_event,
            "luck": self.handle_luck_event,
            "bad_luck": self.handle_bad_luck_event
        }
    
    def handle_event(self, event_type, player, data):
        """å¤„ç†åœ°å›¾äº‹ä»¶"""
        if event_type in self.event_handlers:
            return self.event_handlers[event_type](player, data)
        return None
    
    def handle_bank_event(self, player, data):
        """å¤„ç†é“¶è¡Œäº‹ä»¶"""
        action = data.get("action")
        amount = data.get("amount", 0)
        
        if action == "deposit":
            if player.balance >= amount:
                player.balance -= amount
                player.bank_balance += amount
                return {
                    "success": True,
                    "message": f"å­˜æ¬¾æˆåŠŸï¼Œé‡‘é¢ï¼š{amount}",
                    "new_balance": player.balance,
                    "new_bank_balance": player.bank_balance
                }
        elif action == "withdraw":
            if player.bank_balance >= amount:
                player.bank_balance -= amount
                player.balance += amount
                return {
                    "success": True,
                    "message": f"å–æ¬¾æˆåŠŸï¼Œé‡‘é¢ï¼š{amount}",
                    "new_balance": player.balance,
                    "new_bank_balance": player.bank_balance
                }
        
        return {
            "success": False,
            "message": "æ“ä½œå¤±è´¥ï¼Œä½™é¢ä¸è¶³"
        }
    
    def handle_shop_event(self, player, data):
        """å¤„ç†å•†åº—äº‹ä»¶"""
        action = data.get("action")
        item_type = data.get("item_type")
        
        if action == "buy_item":
            item = self.game_map.get_shop_item(item_type)
            if item and player.balance >= item["price"]:
                player.balance -= item["price"]
                player.add_item(item_type)
                return {
                    "success": True,
                    "message": f"è´­ä¹°æˆåŠŸï¼Œè·å¾—{item_type}",
                    "new_balance": player.balance
                }
        
        return {
            "success": False,
            "message": "è´­ä¹°å¤±è´¥ï¼Œä½™é¢ä¸è¶³æˆ–å•†å“ä¸å­˜åœ¨"
        }
    
    def handle_jail_event(self, player, data):
        """å¤„ç†ç›‘ç‹±äº‹ä»¶"""
        action = data.get("action")
        
        if action == "pay_bail":
            bail_cost = self.game_map.get_jail_bail_cost()
            if player.balance >= bail_cost:
                player.balance -= bail_cost
                player.in_jail = False
                return {
                    "success": True,
                    "message": "ä¿é‡ŠæˆåŠŸï¼Œå¯ä»¥ç»§ç»­æ¸¸æˆ",
                    "new_balance": player.balance
                }
        elif action == "wait":
            player.jail_turns += 1
            if player.jail_turns >= 3:
                player.in_jail = False
                return {
                    "success": True,
                    "message": "åˆ‘æ»¡é‡Šæ”¾ï¼Œå¯ä»¥ç»§ç»­æ¸¸æˆ"
                }
            return {
                "success": True,
                "message": f"è¿˜éœ€è¦ç­‰å¾…{3 - player.jail_turns}å›åˆ"
            }
        
        return {
            "success": False,
            "message": "æ“ä½œå¤±è´¥"
        }
    
    def handle_luck_event(self, player, data):
        """å¤„ç†å¥½è¿äº‹ä»¶"""
        reward = data.get("reward")
        
        if reward["type"] == "money":
            player.balance += reward["amount"]
            return {
                "success": True,
                "message": f"è·å¾—{reward['amount']}å…ƒ",
                "new_balance": player.balance
            }
        elif reward["type"] == "item":
            player.add_item(reward["item"])
            return {
                "success": True,
                "message": f"è·å¾—{reward['item']}"
            }
        
        return {
            "success": False,
            "message": "å¥–åŠ±å‘æ”¾å¤±è´¥"
        }
    
    def handle_bad_luck_event(self, player, data):
        """å¤„ç†å„è¿äº‹ä»¶"""
        penalty = data.get("penalty")
        
        if penalty["type"] == "money":
            if player.balance >= penalty["amount"]:
                player.balance -= penalty["amount"]
                return {
                    "success": True,
                    "message": f"æŸå¤±{penalty['amount']}å…ƒ",
                    "new_balance": player.balance
                }
        elif penalty["type"] == "card":
            if player.has_card():
                player.lose_card()
                return {
                    "success": True,
                    "message": "å¤±å»ä¸€å¼ å¡ç‰‡"
                }
        elif penalty["type"] == "jail":
            player.in_jail = True
            player.position = self.game_map.get_jail_position()
            return {
                "success": True,
                "message": "è¢«å…³è¿›ç›‘ç‹±"
            }
        
        return {
            "success": False,
            "message": "æƒ©ç½šæ‰§è¡Œå¤±è´¥"
        }
```

### 2.4 å›¾å½¢åŒ–åœ°å›¾ç¼–è¾‘å™¨ï¼ˆæ–°å¢ï¼‰

#### 2.4.1 ç•Œé¢è®¾è®¡éœ€æ±‚
1. **ä¸»ç•Œé¢å¸ƒå±€**
   - åœ°å›¾æ˜¾ç¤ºåŒºåŸŸï¼ˆå±…ä¸­ï¼Œå¯ç¼©æ”¾ï¼‰
   - å·¥å…·æ ï¼ˆå·¦ä¾§ï¼ŒåŒ…å«å„ç§å·¥å…·ï¼‰
   - å±æ€§é¢æ¿ï¼ˆå³ä¾§ï¼Œæ˜¾ç¤ºé€‰ä¸­æ ¼å­çš„å±æ€§ï¼‰
   - èœå•æ ï¼ˆé¡¶éƒ¨ï¼Œæ–‡ä»¶æ“ä½œã€ç¼–è¾‘æ“ä½œç­‰ï¼‰

2. **å·¥å…·æ åŠŸèƒ½**
   - é€‰æ‹©å·¥å…·ï¼šç‚¹å‡»é€‰æ‹©æ ¼å­
   - æ ¼å­ç±»å‹å·¥å…·ï¼šé“¶è¡Œã€å•†åº—ã€ç›‘ç‹±ã€å¥½è¿æ ¼ã€å„è¿æ ¼
   - è·¯éšœå·¥å…·ï¼šæ”¾ç½®/ç§»é™¤è·¯éšœ
   - æˆ¿äº§å·¥å…·ï¼šè®¾ç½®æˆ¿äº§ç­‰çº§å’Œæ‰€æœ‰è€…
   - è·¯å¾„å·¥å…·ï¼šç¼–è¾‘åœ°å›¾è·¯å¾„
   - æ©¡çš®æ“¦å·¥å…·ï¼šæ¸…é™¤æ ¼å­è®¾ç½®

3. **åœ°å›¾æ˜¾ç¤º**
   - ç½‘æ ¼æ˜¾ç¤ºï¼šæ¸…æ™°æ˜¾ç¤ºåœ°å›¾è¾¹ç•Œ
   - é¢œè‰²ç¼–ç ï¼šä¸åŒæ ¼å­ç±»å‹ç”¨ä¸åŒé¢œè‰²æ˜¾ç¤º
   - å›¾æ ‡æ˜¾ç¤ºï¼šç‰¹æ®Šæ ¼å­æ˜¾ç¤ºå¯¹åº”å›¾æ ‡
   - å®æ—¶é¢„è§ˆï¼šé¼ æ ‡æ‚¬åœæ˜¾ç¤ºæ ¼å­ä¿¡æ¯

#### 2.4.2 äº¤äº’åŠŸèƒ½
1. **é¼ æ ‡æ“ä½œ**
   - å·¦é”®ç‚¹å‡»ï¼šé€‰æ‹©æ ¼å­æˆ–åº”ç”¨å·¥å…·
   - å³é”®ç‚¹å‡»ï¼šæ˜¾ç¤ºä¸Šä¸‹æ–‡èœå•
   - æ‹–æ‹½ï¼šç§»åŠ¨åœ°å›¾è§†å›¾
   - æ»šè½®ï¼šç¼©æ”¾åœ°å›¾

2. **é”®ç›˜å¿«æ·é”®**
   - Ctrl+Sï¼šä¿å­˜åœ°å›¾
   - Ctrl+Oï¼šæ‰“å¼€åœ°å›¾
   - Ctrl+Nï¼šæ–°å»ºåœ°å›¾
   - Ctrl+Zï¼šæ’¤é”€æ“ä½œ
   - Ctrl+Yï¼šé‡åšæ“ä½œ
   - Deleteï¼šåˆ é™¤é€‰ä¸­æ ¼å­è®¾ç½®

3. **å·¥å…·åˆ‡æ¢**
   - æ•°å­—é”®1-6ï¼šå¿«é€Ÿåˆ‡æ¢æ ¼å­ç±»å‹
   - Ré”®ï¼šåˆ‡æ¢åˆ°è·¯éšœå·¥å…·
   - Pé”®ï¼šåˆ‡æ¢åˆ°è·¯å¾„å·¥å…·
   - Eé”®ï¼šåˆ‡æ¢åˆ°æ©¡çš®æ“¦å·¥å…·

#### 2.4.3 æ•°æ®ç®¡ç†é›†æˆ
1. **æ–‡ä»¶æ“ä½œ**
   - æ–°å»ºåœ°å›¾ï¼šè®¾ç½®å°ºå¯¸ï¼Œåˆ›å»ºç©ºç™½åœ°å›¾
   - æ‰“å¼€åœ°å›¾ï¼šæ”¯æŒJSONã€Excelã€æ•°æ®åº“æ ¼å¼
   - ä¿å­˜åœ°å›¾ï¼šé€‰æ‹©æ ¼å¼ä¿å­˜
   - å¯¼å‡ºåœ°å›¾ï¼šå¯¼å‡ºä¸ºå›¾ç‰‡æˆ–å…¶ä»–æ ¼å¼

2. **åœ°å›¾éªŒè¯**
   - å®æ—¶éªŒè¯ï¼šç¼–è¾‘æ—¶å®æ—¶æ£€æŸ¥åœ°å›¾åˆç†æ€§
   - éªŒè¯æŠ¥å‘Šï¼šæ˜¾ç¤ºé”™è¯¯å’Œè­¦å‘Šä¿¡æ¯
   - è‡ªåŠ¨ä¿®å¤ï¼šæä¾›è‡ªåŠ¨ä¿®å¤å»ºè®®

#### 2.4.4 æŠ€æœ¯å®ç°æ–¹æ¡ˆ
1. **ç•Œé¢æ¡†æ¶é€‰æ‹©**
   - ä½¿ç”¨tkinterï¼ˆPythonå†…ç½®ï¼Œè½»é‡çº§ï¼‰
   - æˆ–ä½¿ç”¨PyQt5/PySide2ï¼ˆåŠŸèƒ½å¼ºå¤§ï¼Œç•Œé¢ç¾è§‚ï¼‰
   - æˆ–ä½¿ç”¨Kivyï¼ˆè·¨å¹³å°ï¼Œé€‚åˆæ¸¸æˆå¼€å‘ï¼‰

2. **æ ¸å¿ƒç±»è®¾è®¡**
```python
class MapEditorGUI:
    def __init__(self):
        self.root = tk.Tk()
        self.canvas = tk.Canvas()
        self.toolbar = tk.Frame()
        self.property_panel = tk.Frame()
        self.current_tool = "select"
        self.selected_cell = None
        self.map_data_manager = MapDataManager()
        self.current_map = None
        self.setup_ui()
    
    def setup_ui(self):
        """è®¾ç½®ç”¨æˆ·ç•Œé¢"""
        # åˆ›å»ºèœå•æ 
        self.create_menu()
        
        # åˆ›å»ºå·¥å…·æ 
        self.create_toolbar()
        
        # åˆ›å»ºåœ°å›¾ç”»å¸ƒ
        self.create_canvas()
        
        # åˆ›å»ºå±æ€§é¢æ¿
        self.create_property_panel()
    
    def create_menu(self):
        """åˆ›å»ºèœå•æ """
        menubar = tk.Menu(self.root)
        
        # æ–‡ä»¶èœå•
        file_menu = tk.Menu(menubar, tearoff=0)
        file_menu.add_command(label="æ–°å»º", command=self.new_map)
        file_menu.add_command(label="æ‰“å¼€", command=self.open_map)
        file_menu.add_command(label="ä¿å­˜", command=self.save_map)
        file_menu.add_separator()
        file_menu.add_command(label="é€€å‡º", command=self.root.quit)
        menubar.add_cascade(label="æ–‡ä»¶", menu=file_menu)
        
        # ç¼–è¾‘èœå•
        edit_menu = tk.Menu(menubar, tearoff=0)
        edit_menu.add_command(label="æ’¤é”€", command=self.undo)
        edit_menu.add_command(label="é‡åš", command=self.redo)
        menubar.add_cascade(label="ç¼–è¾‘", menu=edit_menu)
        
        self.root.config(menu=menubar)
    
    def create_toolbar(self):
        """åˆ›å»ºå·¥å…·æ """
        tools = [
            ("é€‰æ‹©", "select"),
            ("é“¶è¡Œ", "bank"),
            ("å•†åº—", "shop"),
            ("ç›‘ç‹±", "jail"),
            ("å¥½è¿æ ¼", "luck"),
            ("å„è¿æ ¼", "bad_luck"),
            ("è·¯éšœ", "roadblock"),
            ("æˆ¿äº§", "property"),
            ("æ©¡çš®æ“¦", "eraser")
        ]
        
        for text, tool in tools:
            btn = tk.Button(self.toolbar, text=text, 
                          command=lambda t=tool: self.set_tool(t))
            btn.pack(side=tk.LEFT, padx=2, pady=2)
    
    def create_canvas(self):
        """åˆ›å»ºåœ°å›¾ç”»å¸ƒ"""
        self.canvas.bind("<Button-1>", self.on_canvas_click)
        self.canvas.bind("<B1-Motion>", self.on_canvas_drag)
        self.canvas.bind("<MouseWheel>", self.on_canvas_scroll)
        self.canvas.pack(expand=True, fill=tk.BOTH)
    
    def create_property_panel(self):
        """åˆ›å»ºå±æ€§é¢æ¿"""
        # æ˜¾ç¤ºé€‰ä¸­æ ¼å­çš„å±æ€§
        self.property_label = tk.Label(self.property_panel, text="æœªé€‰æ‹©æ ¼å­")
        self.property_label.pack()
    
    def on_canvas_click(self, event):
        """å¤„ç†ç”»å¸ƒç‚¹å‡»äº‹ä»¶"""
        # å°†ç”»å¸ƒåæ ‡è½¬æ¢ä¸ºåœ°å›¾åæ ‡
        map_x, map_y = self.canvas_to_map_coords(event.x, event.y)
        
        if self.current_tool == "select":
            self.select_cell(map_x, map_y)
        elif self.current_tool in ["bank", "shop", "jail", "luck", "bad_luck"]:
            self.set_cell_type(map_x, map_y, self.current_tool)
        elif self.current_tool == "roadblock":
            self.toggle_roadblock(map_x, map_y)
        elif self.current_tool == "eraser":
            self.clear_cell(map_x, map_y)
        
        self.redraw_map()
    
    def redraw_map(self):
        """é‡ç»˜åœ°å›¾"""
        self.canvas.delete("all")
        
        if not self.current_map:
            return
        
        # ç»˜åˆ¶ç½‘æ ¼
        self.draw_grid()
        
        # ç»˜åˆ¶æ ¼å­
        self.draw_cells()
        
        # ç»˜åˆ¶è·¯å¾„
        self.draw_path()
    
    def draw_grid(self):
        """ç»˜åˆ¶ç½‘æ ¼"""
        cell_size = 30
        for x in range(self.current_map.width + 1):
            x_pos = x * cell_size
            self.canvas.create_line(x_pos, 0, x_pos, 
                                  self.current_map.height * cell_size, 
                                  fill="gray")
        
        for y in range(self.current_map.height + 1):
            y_pos = y * cell_size
            self.canvas.create_line(0, y_pos, 
                                  self.current_map.width * cell_size, y_pos, 
                                  fill="gray")
    
    def draw_cells(self):
        """ç»˜åˆ¶æ ¼å­"""
        cell_size = 30
        for cell in self.current_map.cells:
            x = cell.x * cell_size
            y = cell.y * cell_size
            
            # æ ¹æ®æ ¼å­ç±»å‹è®¾ç½®é¢œè‰²
            color = self.get_cell_color(cell.cell_type)
            
            # ç»˜åˆ¶æ ¼å­èƒŒæ™¯
            self.canvas.create_rectangle(x, y, x + cell_size, y + cell_size,
                                       fill=color, outline="black")
            
            # ç»˜åˆ¶æ ¼å­å†…å®¹
            self.draw_cell_content(cell, x, y, cell_size)
    
    def get_cell_color(self, cell_type):
        """è·å–æ ¼å­é¢œè‰²"""
        colors = {
            "empty": "white",
            "bank": "green",
            "shop": "orange",
            "jail": "red",
            "luck": "purple",
            "bad_luck": "brown"
        }
        return colors.get(cell_type, "white")
    
    def draw_cell_content(self, cell, x, y, size):
        """ç»˜åˆ¶æ ¼å­å†…å®¹"""
        # ç»˜åˆ¶æ ¼å­ç±»å‹æ–‡å­—
        text = cell.cell_type[:3].upper()
        self.canvas.create_text(x + size//2, y + size//2, text=text)
        
        # å¦‚æœæœ‰è·¯éšœï¼Œç»˜åˆ¶è·¯éšœæ ‡è®°
        if cell.roadblock:
            self.canvas.create_text(x + size//2, y + size//4, text="ğŸš§", font=("Arial", 10))
        
        # å¦‚æœæœ‰æˆ¿äº§ï¼Œç»˜åˆ¶æˆ¿äº§ç­‰çº§
        if cell.property and cell.property.level > 0:
            self.canvas.create_text(x + size//2, y + 3*size//4, 
                                  text=str(cell.property.level), 
                                  fill="blue", font=("Arial", 12, "bold"))
```

#### 2.4.5 é›†æˆåˆ°æ¸¸æˆç³»ç»Ÿ
1. **å¯åŠ¨æ–¹å¼**
   - ç‹¬ç«‹å¯åŠ¨ï¼šä½œä¸ºç‹¬ç«‹å·¥å…·è¿è¡Œ
   - æ¸¸æˆå†…å¯åŠ¨ï¼šä»æ¸¸æˆä¸»èœå•è¿›å…¥
   - å‘½ä»¤è¡Œå¯åŠ¨ï¼šä¿ç•™å‘½ä»¤è¡Œç‰ˆæœ¬ä½œä¸ºå¤‡é€‰

2. **æ•°æ®åŒæ­¥**
   - å®æ—¶ä¿å­˜ï¼šç¼–è¾‘æ—¶è‡ªåŠ¨ä¿å­˜åˆ°ä¸´æ—¶æ–‡ä»¶
   - ç‰ˆæœ¬æ§åˆ¶ï¼šæ”¯æŒåœ°å›¾ç‰ˆæœ¬ç®¡ç†
   - å¯¼å…¥å¯¼å‡ºï¼šæ”¯æŒåœ°å›¾æ¨¡æ¿å¯¼å…¥å¯¼å‡º

3. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
   - æ“ä½œæç¤ºï¼šæ˜¾ç¤ºå½“å‰å·¥å…·å’Œæ“ä½œè¯´æ˜
   - å¿«æ·é”®æç¤ºï¼šæ˜¾ç¤ºå¯ç”¨çš„å¿«æ·é”®
   - æ’¤é”€é‡åšï¼šæ”¯æŒå¤šæ­¥æ’¤é”€å’Œé‡åš
   - è‡ªåŠ¨ä¿å­˜ï¼šå®šæœŸè‡ªåŠ¨ä¿å­˜é˜²æ­¢æ•°æ®ä¸¢å¤±

## 3. æ¥å£è®¾è®¡

### 3.1 ä¸åŸºç¡€ç¨‹åºæ¥å£
1. **åœ°å›¾æ•°æ®æ¥å£**
   - åœ°å›¾åŠ è½½
   - åœ°å›¾ä¿å­˜
   - æ•°æ®åŒæ­¥

2. **ç©å®¶æ“ä½œæ¥å£**
   - ç§»åŠ¨æ§åˆ¶
   - äº‹ä»¶å¤„ç†
   - çŠ¶æ€æ›´æ–°

### 3.2 ä¸ç¾æœ¯èµ„æºæ¥å£
1. **èµ„æºåŠ è½½æ¥å£**
   - å›¾ç‰‡åŠ è½½
   - åŠ¨ç”»åŠ è½½
   - éŸ³æ•ˆåŠ è½½

2. **æ¸²æŸ“æ¥å£**
   - åœ°å›¾æ¸²æŸ“
   - ç‰¹æ•ˆæ¸²æŸ“
   - ç•Œé¢æ¸²æŸ“

## 4. å¼€å‘ä»»åŠ¡

### 4.1 ç¬¬ä¸€é˜¶æ®µï¼ˆ2å‘¨ï¼‰
1. **åœ°å›¾åŸºç¡€åŠŸèƒ½**
   - åœ°å›¾æ•°æ®ç»“æ„
   - è·¯å¾„ç³»ç»Ÿ
   - åŸºç¡€æ ¼å­

2. **æ•°æ®å­˜å‚¨ç³»ç»Ÿ**
   - æ–‡ä»¶æ ¼å¼æ”¯æŒ
   - æ•°æ®å¯¼å…¥å¯¼å‡º
   - æ•°æ®éªŒè¯

### 4.2 ç¬¬äºŒé˜¶æ®µï¼ˆ2å‘¨ï¼‰
1. **æ ¼å­æ•ˆæœç³»ç»Ÿ**
   - ç‰¹æ®Šæ ¼å­å®ç°
   - äº‹ä»¶å¤„ç†
   - æ•ˆæœè§¦å‘

2. **ç§»åŠ¨æ§åˆ¶ç³»ç»Ÿ**
   - è·¯å¾„è®¡ç®—
   - é“å…·å½±å“
   - ç‰¹æ®Šç§»åŠ¨

### 4.3 ç¬¬ä¸‰é˜¶æ®µï¼ˆ2å‘¨ï¼‰
1. **åœ°å›¾ç¼–è¾‘å™¨**
   - ç•Œé¢è®¾è®¡
   - ç¼–è¾‘åŠŸèƒ½
   - é¢„è§ˆåŠŸèƒ½

2. **æµ‹è¯•ä¸ä¼˜åŒ–**
   - åŠŸèƒ½æµ‹è¯•
   - æ€§èƒ½ä¼˜åŒ–
   - æ–‡æ¡£å®Œå–„

## 5. åä½œæµç¨‹

### 5.1 ä¸åŸºç¡€ç¨‹åºåä½œ
1. **æ•°æ®åŒæ­¥**
   - åœ°å›¾æ•°æ®åŒæ­¥
   - ç©å®¶çŠ¶æ€åŒæ­¥
   - äº‹ä»¶åŒæ­¥

2. **åŠŸèƒ½å¯¹æ¥**
   - ç§»åŠ¨ç³»ç»Ÿå¯¹æ¥
   - äº‹ä»¶ç³»ç»Ÿå¯¹æ¥
   - é“å…·ç³»ç»Ÿå¯¹æ¥

### 5.2 ä¸ç¾æœ¯åä½œ
1. **èµ„æºå¯¹æ¥**
   - å›¾ç‰‡èµ„æº
   - åŠ¨ç”»èµ„æº
   - éŸ³æ•ˆèµ„æº

2. **ç•Œé¢å¯¹æ¥**
   - åœ°å›¾ç•Œé¢
   - ç‰¹æ•ˆç•Œé¢
   - æ“ä½œç•Œé¢

## 6. æµ‹è¯•è¦æ±‚

### 6.1 å•å…ƒæµ‹è¯•
1. **åœ°å›¾åŠŸèƒ½æµ‹è¯•**
   - æ•°æ®ç»“æ„æµ‹è¯•
   - è·¯å¾„ç³»ç»Ÿæµ‹è¯•
   - æ ¼å­ç³»ç»Ÿæµ‹è¯•

2. **äº‹ä»¶ç³»ç»Ÿæµ‹è¯•**
   - äº‹ä»¶è§¦å‘æµ‹è¯•
   - æ•ˆæœå¤„ç†æµ‹è¯•
   - çŠ¶æ€æ›´æ–°æµ‹è¯•

### 6.2 é›†æˆæµ‹è¯•
1. **ç³»ç»Ÿé›†æˆæµ‹è¯•**
   - ä¸åŸºç¡€ç¨‹åºé›†æˆ
   - ä¸ç¾æœ¯ç³»ç»Ÿé›†æˆ
   - ä¸ç½‘ç»œç³»ç»Ÿé›†æˆ

2. **æ€§èƒ½æµ‹è¯•**
   - åŠ è½½æ€§èƒ½
   - è¿è¡Œæ€§èƒ½
   - å†…å­˜ä½¿ç”¨

## 7. æ€§èƒ½è¦æ±‚

### 7.1 å“åº”æ—¶é—´
1. **åœ°å›¾åŠ è½½**
   - é¦–æ¬¡åŠ è½½ < 2ç§’
   - åˆ‡æ¢åœ°å›¾ < 1ç§’

2. **æ“ä½œå“åº”**
   - ç§»åŠ¨å“åº” < 100ms
   - äº‹ä»¶å“åº” < 200ms

### 7.2 èµ„æºä½¿ç”¨
1. **å†…å­˜ä½¿ç”¨**
   - åœ°å›¾æ•°æ® < 50MB
   - è¿è¡Œæ—¶ < 200MB

2. **CPUä½¿ç”¨**
   - ç©ºé—²æ—¶ < 5%
   - è¿è¡Œæ—¶ < 30%

## 8. å¼€å‘å·¥å…·

### 8.1 å¿…éœ€å·¥å…·
1. **å¼€å‘ç¯å¢ƒ**
   - Python 3.8+
   - PyCharm
   - Git

2. **æµ‹è¯•å·¥å…·**
   - pytest
   - coverage
   - memory_profiler

### 8.2 æ¨èå·¥å…·
1. **å¼€å‘å·¥å…·**
   - Visual Studio Code
   - PyLint
   - Black

2. **è°ƒè¯•å·¥å…·**
   - pdb
   - logging
   - trace

## 9. æ–‡æ¡£ç»´æŠ¤

### 9.1 ä»£ç æ–‡æ¡£
1. **æ³¨é‡Šè§„èŒƒ**
   - å‡½æ•°æ³¨é‡Š
   - ç±»æ³¨é‡Š
   - æ¨¡å—æ³¨é‡Š

2. **æ–‡æ¡£æ›´æ–°**
   - ä»£ç æ›´æ–°åŒæ­¥
   - æ¥å£æ–‡æ¡£æ›´æ–°
   - ä½¿ç”¨è¯´æ˜æ›´æ–°

### 9.2 å¼€å‘æ–‡æ¡£
1. **è®¾è®¡æ–‡æ¡£**
   - æ¶æ„è®¾è®¡
   - æ¥å£è®¾è®¡
   - æ•°æ®ç»“æ„

2. **æµ‹è¯•æ–‡æ¡£**
   - æµ‹è¯•ç”¨ä¾‹
   - æµ‹è¯•æŠ¥å‘Š
   - é—®é¢˜è®°å½•